import{d as H,u as K,c as q,ds as A,r as i,b as D,w as j,o as z,g as f,h as _,i as s,t as l,dt as m,x as c,y as O,n as $,p as G,q as J,B as Q,dw as X,R as Y,s as Z}from"./index.a3c5a5ee.js";import{B as P}from"./BaseInput.9f8543fa.js";import{a as oo}from"./auth-service.8a94e5d8.js";import{a as M}from"./login-param.68049c90.js";import{E as so}from"./error-code-enum.da80d5c7.js";import"./text_box.c18f19ed.js";const C=v=>(G("data-v-8d823949"),v=v(),J(),v),eo={class:"login-container w-100 h-100"},to={class:"login-form"},ao={class:"w-100"},no={class:"title-form"},ro={class:"main-form"},io={key:0},lo={class:"text-center"},co={class:"group-form"},uo={class:"label"},wo=C(()=>s("span",{style:{color:"red"}}," *",-1)),po={class:"flex1"},vo={class:"button w-100"},ho={key:1},go=["innerHTML"],fo={class:"group-form"},_o={class:"label"},mo=C(()=>s("span",{style:{color:"red"}}," *",-1)),Po={class:"flex1"},Co={class:"button w-100"},yo={key:2},So=["innerHTML"],Fo={class:"group-form"},To={class:"label"},ko=C(()=>s("span",{style:{color:"red"}}," *",-1)),Io={class:"flex1"},Oo={class:"group-form"},$o={class:"label"},Eo=C(()=>s("span",{style:{color:"red"}}," *",-1)),No={class:"flex1"},Ro={class:"button w-100"},Lo=H({__name:"ForgotPassword",setup(v){const u=K(),{t:r}=q(),Mo=A(),x=i(!1),d=new Q,b=D(),h=i({Mode:"password",IsShowPassword:!1}),g=i({Mode:"password",IsShowPassword:!1}),w=i(""),t=i({code:"",verificationId:"",password:"",passwordConfirm:""}),p=i(1),y=i(!1),B=i(!1),S=i(!1);j(()=>b.query,async o=>{w.value=o.username||""},{immediate:!0}),z(()=>{});async function F(o=""){return await(u==null?void 0:u.recaptchaLoaded()),await(u==null?void 0:u.executeRecaptcha(o))}async function xo(o){if(!o.username||!o.password){d.showToastWarning(r("ToastMessgage.LoginEmpty"));return}x.value=!0;const e=new URLSearchParams;e.append("grant_type",o.grant_type),e.append("client_id",o.client_id),e.append("client_secret",o.client_secret),e.append("username",o.username),e.append("password",o.password);const n={headers:{captcha:await F("Login")}},L=await oo.login(e,n)}function T(o){setTimeout(()=>{o.component.focus()},0)}function V(o){h.value.Mode=o?"text":"password",h.value.IsShowPassword=o}function U(o){g.value.Mode=o?"text":"password",g.value.IsShowPassword=o}function W(o){w.value=o}function E(){X.push({name:Y.Login})}async function N(){if(!w.value){d.showToastWarning(r("ForgotPassword.UsernameEmpty"));return}y.value=!0;const e={headers:{captcha:await F("RecoverAccount")}},a={username:w.value},n=await M.recoverAccount(a,e);if(y.value=!1,n&&n.data){const L=n.data;t.value.verificationId=L.verificationId,p.value=2}else(n==null?void 0:n.errorCode)==so.UserNameNotNerified?d.showToastError(r("ForgotPassword.UserNameNotNerified")):d.showToastError(r("Common.Error"))}function R(){if(!t.value.code){d.showToastWarning(r("ForgotPassword.CodeEmpty"));return}p.value=3}async function k(){if(!t.value.password||!t.value.passwordConfirm){d.showToastWarning(r("ForgotPassword.PasswordEmpty"));return}if(t.value.password!=t.value.passwordConfirm){d.showToastWarning(r("ForgotPassword.PasswordConfirmFail"));return}S.value=!0;const e={headers:{captcha:await F("RecoverPassword")}},a={code:t.value.code,verificationId:t.value.verificationId,password:t.value.password},n=await M.recoverPassword(a,e);S.value=!1,n&&n.data?(d.showToastSuccess(r("ForgotPassword.ChangePasswordSuccess")),E()):d.showToastError(r("ForgotPassword.ChangePasswordFailed"))}function I(o,e=""){event==null||!e||(t.value[e]=o)}return(o,e)=>(f(),_("div",eo,[s("div",to,[s("div",ao,[s("div",no,l(o.$t("ForgotPassword.Title")),1)]),s("div",ro,[p.value==1?(f(),_("div",io,[s("div",lo,l(o.$t("ForgotPassword.Note")),1),s("div",co,[s("div",uo,[m(l(o.$t("ForgotPassword.Username")),1),wo]),s("div",po,[c(P,{value:w.value,placeholder:o.$t("ForgotPassword.Username_Placeholder"),onOnValueChanged:e[0]||(e[0]=a=>W(a)),onOnContentReady:T,onOnEnterKey:N},null,8,["value","placeholder"])])]),s("div",vo,[c(O,{width:"100%",height:"50px",text:o.$t("ForgotPassword.Title"),type:"default","styling-mode":"contained",loading:y.value,onOnClick:N},null,8,["text","loading"])])])):$("",!0),p.value==2?(f(),_("div",ho,[s("div",{class:"text-center",innerHTML:o.$t("ForgotPassword.Note_Code")},null,8,go),s("div",fo,[s("div",_o,[m(l(o.$t("ForgotPassword.Code")),1),mo]),s("div",Po,[c(P,{value:t.value.code,placeholder:o.$t("ForgotPassword.Code_Placeholder"),onOnValueChanged:e[1]||(e[1]=a=>I(a,"code")),onOnContentReady:T,onOnEnterKey:R},null,8,["value","placeholder"])])]),s("div",Co,[c(O,{width:"100%",height:"50px",text:o.$t("Common.Continue"),type:"default","styling-mode":"contained",loading:B.value,onOnClick:R},null,8,["text","loading"])])])):$("",!0),p.value==3?(f(),_("div",yo,[s("div",{class:"text-center",innerHTML:o.$t("ForgotPassword.Note_Password")},null,8,So),s("div",Fo,[s("div",To,[m(l(o.$t("ForgotPassword.NewPassword")),1),ko]),s("div",Io,[c(P,{mode:h.value.Mode,isShowPassword:h.value.IsShowPassword,value:t.value.password,placeholder:o.$t("ForgotPassword.NewPassword"),onOnValueChanged:e[2]||(e[2]=a=>I(a,"password")),onOnToggleShowPassword:V,onOnContentReady:T,onOnEnterKey:k},null,8,["mode","isShowPassword","value","placeholder"])])]),s("div",Oo,[s("div",$o,[m(l(o.$t("ForgotPassword.ConfirmPassword")),1),Eo]),s("div",No,[c(P,{mode:g.value.Mode,isShowPassword:g.value.IsShowPassword,value:t.value.passwordConfirm,placeholder:o.$t("ForgotPassword.ConfirmPassword"),onOnValueChanged:e[3]||(e[3]=a=>I(a,"passwordConfirm")),onOnToggleShowPassword:U,onOnEnterKey:k},null,8,["mode","isShowPassword","value","placeholder"])])]),s("div",Ro,[c(O,{width:"100%",height:"50px",text:o.$t("ForgotPassword.CreatePassword"),type:"default","styling-mode":"contained",loading:S.value,onOnClick:k},null,8,["text","loading"])])])):$("",!0)]),s("div",{class:"button-link text-center pointer mt-3",onClick:E},[s("a",null,l(o.$t("ForgotPassword.ReturnLogin")),1)])])]))}});const Ko=Z(Lo,[["__scopeId","data-v-8d823949"]]);export{Ko as default};
