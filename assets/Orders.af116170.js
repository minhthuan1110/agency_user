import{d as X,u as Y,c as Z,r as o,e as ee,f as l,o as te,g as L,h as ae,i as d,t as ne,x as b,m as se,j as oe,y as re,n as ie,k as u,F as ce,p as ke,q as Pe,B as le,s as de}from"./index.a3c5a5ee.js";import{_ as ue}from"./BaseGrid.e652126b.js";import pe from"./BasePopupDelete.b52e37da.js";import{C as a}from"./ColumnDataGrid.23bec9a2.js";import{c as fe,L as me,b as ye,a as ve,O as $}from"./order-service.5ecf97c1.js";import{L as ge}from"./list-status.a9bf9ad2.js";import"./select_box.05db16a2.js";import"./text_box.c18f19ed.js";import"./popover.51293f7e.js";import"./number_box.546ccd32.js";import"./draggable.1b572f7d.js";const Se={class:"container"},we={class:"d-flex justify-content-between align-items-center mb-3"},_e={class:"title"},Ce={class:"grid-orders mt-3"},he={class:"d-flex align-items-center"},Oe=X({__name:"Orders",setup(De){const i=Y(),{t}=Z(),C=new le;let y=o(1),p=o(25),h=o(0);const f=ee(()=>({SkipCount:(y.value-1)*p.value,MaxResultCount:p.value})),N=o({Status:0,UserId:null}),O=o(new Array);let D=o([]),v=o(!1);const z=l(fe),H=l(me),U=l(ye),V=l(ve),E=l(ge),g=o(!1),S=o(!1);let x="";te(()=>{G(),c()});function G(){O.value=[new a("#","Index","60px"),new a(t("Order.Code"),"code"),new a(t("Order.UrlService"),"urlService"),new a(t("Order.Quantity"),"quantity","auto","","left",!1,"","","number","#,##0.##"),new a(t("Order.Completed"),"completedQuantity","auto","","left",!1,"","","number","#,##0.##"),new a(t("Order.Application"),"ApplicationDisplay"),new a(t("Order.ServiceType"),"ServiceTypeDisplay"),new a(t("Order.Speed"),"SpeedDisplay"),new a(t("Order.Warranty"),"WarrantyDisplay"),new a(t("Order.Total"),"price","120px","","left",!1,"","","number","#,##0.## \u0111"),new a(t("Order.DoActionTime"),"doActionTime","auto","","center",!1,"","","date","dd/MM/yyyy HH:mm:ss"),new a(t("Order.DoResultTime"),"doResultTime","auto","","center",!1,"","","date","dd/MM/yyyy HH:mm:ss"),new a(t("Order.CreatedDate"),"creationTime","auto","","center",!1,"","","date","dd/MM/yyyy HH:mm:ss"),new a(t("Order.Status"),"StatusDisplay"),new a(t("Order.Action"),"action","125px","custom","center",!0,"right")]}async function I(e=""){return await(i==null?void 0:i.recaptchaLoaded()),await(i==null?void 0:i.executeRecaptcha(e))}function W(){const e=new URLSearchParams;return typeof f.value.SkipCount<"u"&&e.append("SkipCount",f.value.SkipCount.toString()),typeof f.value.MaxResultCount<"u"&&e.append("MaxResultCount",f.value.MaxResultCount.toString()),e}async function c(){v.value=!0;const e=W(),r={headers:{captcha:await I("GetOrder")},params:e},m=await $.getPaging(r);if(m&&m.data){const _=m.data;h.value=_.totalCount,_.items.forEach((n,K)=>{var k,P,A,M,R,B;if(n.Index=K+1,(k=n.service)!=null&&k.service&&(n.ApplicationDisplay=((P=z.find(s=>s.ID==n.service.service.application))==null?void 0:P.Name)||"",n.ServiceTypeDisplay=((A=H.find(s=>s.ID==n.service.service.serviceType))==null?void 0:A.Name)||""),n.speed&&(n.SpeedDisplay=((M=U.find(s=>s.ID==n.speed.type))==null?void 0:M.Name)||""),n.warranty){const s=n.warranty;n.WarrantyDisplay=s.time+" "+((R=V.find(J=>J.ID==s.timeUnit))==null?void 0:R.Name)||""}n.StatusDisplay=t((B=E.find(s=>s.ID==n.status))==null?void 0:B.ResourceKey)}),D.value=_.items,setTimeout(()=>{v.value=!1},50)}}function j(e){p.value=e,c()}function q(e){y.value=e,c()}function xe(e){N.value.Status=e,c()}function F(e){!e||(x=e.id,g.value=!0)}function T(){S.value=!1,g.value=!1}async function Q(){S.value=!0;const w={headers:{captcha:await I("CancelOrder")}},r=await $.cancelOrder(x,null,w);r&&r.data?(C.showToastSuccess("Cancel Order Success!"),c()):(console.log(r),C.showToastError("Cancel Order Error!")),T()}return(e,w)=>(L(),ae(ce,null,[d("div",Se,[d("div",we,[d("div",_e,ne(e.$t("Orders")),1)]),d("div",Ce,[b(ue,{loading:u(v),dataSource:u(D),columns:O.value,total:u(h),pageIndex:u(y),pageSize:u(p),width:"100%",height:"calc(100vh - 209px)",onChangePageSize:j,onChangePageIndex:q},{action:se(({data:r})=>[d("div",he,[r.data.status==1?(L(),oe(re,{key:0,width:"92px",text:e.$t("Cancel"),type:"danger","styling-mode":"outlined",onOnClick:m=>F(r.data)},null,8,["text","onOnClick"])):ie("",!0)])]),_:1},8,["loading","dataSource","columns","total","pageIndex","pageSize"])])]),b(pe,{title:e.$t("CancelOrder"),content:e.$t("ContentCancelOrder"),isVisible:g.value,loading:S.value,textButton:e.$t("Agree"),onClosePopup:T,onOnDelete:Q},null,8,["title","content","isVisible","loading","textButton"])],64))}});const Ue=de(Oe,[["__scopeId","data-v-9f2f9e15"]]);export{Ue as default};
